"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationManage = void 0;
const Errors = require("./errors");
const node_fetch_1 = require("node-fetch");
class NotificationManage {
    constructor(baseUrl, options) {
        this.initComplete = false;
        baseUrl = baseUrl.slice(-1) === "/" ? baseUrl.slice(0, -1) : baseUrl;
        if (!this.isUrl(baseUrl))
            throw new Errors.ArgumentError("baseUrl is invalid.");
        this.baseUrl = baseUrl;
        this.authorizationToken = options.authorizationToken;
    }
    getBaseUrl() {
        return this.baseUrl;
    }
    setAuthorizationToken(authorizationToken) {
        this.authorizationToken = authorizationToken;
    }
    configureForOverrideCustomer(customerID) {
        this.customerID = customerID;
    }
    clearOverrideCustomer() {
        this.customerID = undefined;
        this.initComplete = false;
    }
    async getInfo() {
        const uri = "/manage/info";
        return await this.executeRequest(uri, "GET", "get-info");
    }
    async generateApiKey() {
        let uri = "/manage/apikey";
        return await this.executeRequest(uri, "POST", "create-apikey");
    }
    async getMessages(pageSize, nextPageID) {
        let uri = "/manage/customer/{{customerID}}/messages";
        return await this.executeRequest(uri, "GET", "list-message", undefined, {
            pagesize: pageSize,
            nextpage: nextPageID,
        });
    }
    async getMessage(messageID) {
        const uri = `/manage/customer/{{customerID}}/message/${encodeURIComponent(messageID)}`;
        return await this.executeRequest(uri, "GET", "get-message");
    }
    async createEmailMessage(emailMessage, test) {
        const uri = "/manage/customer/{{customerID}}/message";
        const contentType = test ? "create-test-email-message" : "create-email-message";
        return await this.executeRequest(uri, "POST", contentType, emailMessage);
    }
    async createSmsMessage(smsMessage, test) {
        const uri = "/manage/customer/{{customerID}}/message";
        const contentType = test ? "create-test-sms-message" : "create-sms-message";
        return await this.executeRequest(uri, "POST", contentType, smsMessage);
    }
    async getCustomers(pageSize, nextPageID) {
        let uri = "/manage/customers";
        return await this.executeRequest(uri, "GET", "list-customer", undefined, {
            pagesize: pageSize,
            nextpage: nextPageID,
        });
    }
    async getCustomer(customerID) {
        let uri = "/manage/customer";
        if (customerID != undefined) {
            uri += "/" + encodeURIComponent(customerID);
        }
        return await this.executeRequest(uri, "GET", "get-customer");
    }
    async createCustomer(customer) {
        let uri = "/manage/customer";
        return await this.executeRequest(uri, "POST", "create-customer", customer);
    }
    async updateCustomer(customerID, customer) {
        let uri = `/manage/customer/${encodeURIComponent(customerID)}`;
        return await this.executeRequest(uri, "PATCH", "update-customer", customer);
    }
    async deleteCustomer(customerID) {
        let uri = `/manage/customer/${encodeURIComponent(customerID)}`;
        return await this.executeRequest(uri, "DELETE", "delete-customer");
    }
    async getTemplates(pageSize, nextPageID) {
        const uri = "/manage/customer/{{customerID}}/templates";
        return await this.executeRequest(uri, "GET", "list-template", undefined, {
            pagesize: pageSize,
            nextpage: nextPageID,
        });
    }
    async getTemplate(slug, locale) {
        let uri = `/manage/customer/{{customerID}}/template/${encodeURIComponent(slug)}`;
        if (locale) {
            uri += "/" + encodeURIComponent(locale);
        }
        return await this.executeRequest(uri, "GET", "get-template");
    }
    async createTemplate(template) {
        const uri = "/manage/customer/{{customerID}}/template";
        return await this.executeRequest(uri, "POST", "create-template", template);
    }
    async updateTemplate(slug, locale, template) {
        let uri = `/manage/customer/{{customerID}}/template/${encodeURIComponent(slug)}`;
        if (locale) {
            uri += "/" + encodeURIComponent(locale);
        }
        return await this.executeRequest(uri, "PATCH", "update-template", template);
    }
    async deleteTemplate(slug, locale) {
        let uri = `/manage/customer/{{customerID}}/template/${encodeURIComponent(slug)}`;
        if (locale) {
            uri += "/" + encodeURIComponent(locale);
        }
        return await this.executeRequest(uri, "DELETE", "delete-template");
    }
    async getSenders(pageSize, nextPageID) {
        const uri = "/manage/customer/{{customerID}}/senders";
        return await this.executeRequest(uri, "GET", "list-sender", undefined, {
            pagesize: pageSize,
            nextpage: nextPageID,
        });
    }
    async getSender(senderID) {
        const uri = `/manage/customer/{{customerID}}/sender/${encodeURIComponent(senderID)}`;
        return await this.executeRequest(uri, "GET", "get-sender");
    }
    async createSender(sender) {
        const uri = "/manage/customer/{{customerID}}/sender";
        return await this.executeRequest(uri, "POST", "create-sender", sender);
    }
    async updateSender(senderID, sender) {
        const uri = `/manage/customer/{{customerID}}/sender/${encodeURIComponent(senderID)}`;
        return await this.executeRequest(uri, "PATCH", "update-sender", sender);
    }
    async deleteSender(senderID) {
        const uri = `/manage/customer/{{customerID}}/sender/${encodeURIComponent(senderID)}`;
        return await this.executeRequest(uri, "DELETE", "delete-sender");
    }
    async getAppKeys(pageSize, nextPageID) {
        const uri = "/manage/customer/{{customerID}}/appkeys";
        return await this.executeRequest(uri, "GET", "list-appkey", undefined, {
            pagesize: pageSize,
            nextpage: nextPageID,
        });
    }
    async getAppKey(appKeyID) {
        const uri = `/manage/customer/{{customerID}}/appkey/${encodeURIComponent(appKeyID)}`;
        return await this.executeRequest(uri, "GET", "get-appkey");
    }
    async createAppKey(appKey) {
        const uri = "/manage/customer/{{customerID}}/appkey";
        return await this.executeRequest(uri, "POST", "create-appkey", appKey);
    }
    async updateAppKey(appKeyID, appKey) {
        const uri = `/manage/customer/{{customerID}}/appkey/${encodeURIComponent(appKeyID)}`;
        return await this.executeRequest(uri, "PATCH", "update-appkey", appKey);
    }
    async deleteAppKey(appKeyID) {
        const uri = `/manage/customer/{{customerID}}/appkey/${encodeURIComponent(appKeyID)}`;
        return await this.executeRequest(uri, "DELETE", "delete-appkey");
    }
    async getBlocks(pageSize, nextPageID) {
        const uri = "/manage/customer/{{customerID}}/blocks";
        return await this.executeRequest(uri, "GET", "list-block", undefined, {
            pagesize: pageSize,
            nextpage: nextPageID,
        });
    }
    async getBlock(blockID) {
        const uri = `/manage/customer/{{customerID}}/block/${encodeURIComponent(blockID)}`;
        return await this.executeRequest(uri, "GET", "get-block");
    }
    async createBlock(block) {
        const uri = "/manage/customer/{{customerID}}/block";
        return await this.executeRequest(uri, "POST", "create-block", block);
    }
    async deleteBlock(blockID) {
        const uri = `/manage/customer/{{customerID}}/block/${encodeURIComponent(blockID)}`;
        await this.executeRequest(uri, "DELETE", "delete-block");
    }
    async executeRequest(uri, method, contentTypeResource, requestBody, queryParameters) {
        await this.initClient();
        uri = uri.replace(/{{customerID}}/, encodeURIComponent(this.customerID));
        let qp = "";
        if (queryParameters) {
            for (const [k, v] of Object.entries(queryParameters)) {
                if (v === undefined || v === null) {
                    delete queryParameters[k];
                }
            }
            qp = "?" + new URLSearchParams(queryParameters);
        }
        let requestData = undefined;
        if (requestBody) {
            requestData = (typeof requestBody === "string") ? requestBody : JSON.stringify(requestBody);
        }
        let responseBodyText = undefined;
        let responseBody = undefined;
        let response;
        try {
            response = await (0, node_fetch_1.default)(this.baseUrl + uri + qp, {
                method,
                headers: {
                    "Content-Type": `application/vnd.notification.${contentTypeResource}.v1+json`,
                    "Authorization": this.authorizationToken,
                },
                body: requestData,
            });
            responseBodyText = await response.text();
        }
        catch (ex) {
            throw new Errors.FetchError(ex.message, { cause: ex });
        }
        if (!response) {
            throw new Errors.ResponseError("Server did not respond");
        }
        if (response.status === 401 || response.status === 403) {
            throw new Errors.AuthorizationError("Authorization Failed");
        }
        else if (response.status === 404) {
            throw new Errors.ResponseError("Resource not found");
        }
        try {
            responseBody = responseBodyText && JSON.parse(responseBodyText);
        }
        catch (ex) {
            throw new Errors.ResponseError("Invalid response content", { cause: responseBodyText });
        }
        if (response.status != 200) {
            throw new Errors.ResponseError(responseBody.Error || responseBodyText);
        }
        return responseBody;
    }
    async initClient() {
        if (this.initComplete)
            return;
        this.initComplete = true;
        try {
            const dataItem = await this.getInfo();
            this.customerID = dataItem.CustomerID;
        }
        catch (ex) {
            this.initComplete = false;
            const error = ex;
            if (error instanceof Errors.AuthorizationError)
                throw error;
            else
                throw new Errors.InitError(`Failed to init client: ${error.message}`, { cause: error });
        }
    }
    isUrl(value) {
        try {
            const url = new URL(value);
            return url.protocol === "http:" || url.protocol === "https:";
        }
        catch { }
        return false;
    }
}
exports.NotificationManage = NotificationManage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLW1hbmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9ub3RpZmljYXRpb24tbWFuYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUFtQztBQUVuQywyQ0FBNkM7QUFFN0MsTUFBYSxrQkFBa0I7SUFNOUIsWUFBWSxPQUFjLEVBQUUsT0FBdUM7UUFGM0QsaUJBQVksR0FBVyxLQUFLLENBQUM7UUFHcEMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUVyRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUM7WUFBRSxNQUFNLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBRWhGLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUM7SUFDdEQsQ0FBQztJQUtELFVBQVU7UUFDVCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDckIsQ0FBQztJQUtELHFCQUFxQixDQUFDLGtCQUF5QjtRQUM5QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7SUFDOUMsQ0FBQztJQUtELDRCQUE0QixDQUFDLFVBQWlCO1FBQzdDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0lBQzlCLENBQUM7SUFLRCxxQkFBcUI7UUFDcEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDM0IsQ0FBQztJQUtELEtBQUssQ0FBQyxPQUFPO1FBQ1osTUFBTSxHQUFHLEdBQUcs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TyxLQUFLLENBQUMsS0FBWTtRQUN6QixJQUFJO1lBQ0gsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDM0IsT0FBTyxHQUFHLENBQUMsUUFBUSxLQUFLLE9BQU8sSUFBSSxHQUFHLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQztTQUM3RDtRQUFDLE1BQU0sR0FBRztRQUVYLE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztDQUNEO0FBNWJELGdEQTRiQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEVycm9ycyBmcm9tIFwiLi9lcnJvcnNcIjtcbmltcG9ydCAqIGFzIFR5cGVzIGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgZmV0Y2gsIHsgUmVzcG9uc2UgfSBmcm9tIFwibm9kZS1mZXRjaFwiO1xuXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uTWFuYWdlIHtcblx0cHJpdmF0ZSBiYXNlVXJsOnN0cmluZztcblx0cHJpdmF0ZSBhdXRob3JpemF0aW9uVG9rZW46c3RyaW5nO1xuXHRwcml2YXRlIGN1c3RvbWVySUQ6c3RyaW5nfHVuZGVmaW5lZDtcblx0cHJpdmF0ZSBpbml0Q29tcGxldGU6Ym9vbGVhbiA9IGZhbHNlO1xuXG5cdGNvbnN0cnVjdG9yKGJhc2VVcmw6c3RyaW5nLCBvcHRpb25zOlR5cGVzLk5vdGlmaWNhdGlvbk1hbmFnZU9wdGlvbnMpIHtcblx0XHRiYXNlVXJsID0gYmFzZVVybC5zbGljZSgtMSkgPT09IFwiL1wiID8gYmFzZVVybC5zbGljZSgwLCAtMSkgOiBiYXNlVXJsO1x0Ly8gcmVtb3ZlIHRyYWlsaW5nIHNsYXNoXG5cblx0XHRpZiAoIXRoaXMuaXNVcmwoYmFzZVVybCkpIHRocm93IG5ldyBFcnJvcnMuQXJndW1lbnRFcnJvcihcImJhc2VVcmwgaXMgaW52YWxpZC5cIik7XG5cblx0XHR0aGlzLmJhc2VVcmwgPSBiYXNlVXJsO1xuXHRcdHRoaXMuYXV0aG9yaXphdGlvblRva2VuID0gb3B0aW9ucy5hdXRob3JpemF0aW9uVG9rZW47XG5cdH1cblxuXHQvKipcblx0ICogR2V0IHRoZSBiYXNlVXJsXG5cdCAqL1xuXHRnZXRCYXNlVXJsKCk6c3RyaW5nIHtcblx0XHRyZXR1cm4gdGhpcy5iYXNlVXJsO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldCB0aGUgYXV0aG9yaXphdGlvbiB0b2tlbi4gVXNlZCBieSBhbGwgZnV0dXJlIHJlcXVlc3RzLlxuXHQgKi9cblx0c2V0QXV0aG9yaXphdGlvblRva2VuKGF1dGhvcml6YXRpb25Ub2tlbjpzdHJpbmcpOnZvaWQge1xuXHRcdHRoaXMuYXV0aG9yaXphdGlvblRva2VuID0gYXV0aG9yaXphdGlvblRva2VuO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldCB0aGUgQ3VzdG9tZXIgSUQgdGhhdCB3aWxsIGJlIHBhc3NlZCB0byBhbGwgQVBJIHJlcXVlc3RzLlxuXHQgKi9cblx0Y29uZmlndXJlRm9yT3ZlcnJpZGVDdXN0b21lcihjdXN0b21lcklEOnN0cmluZyk6dm9pZCB7XG5cdFx0dGhpcy5jdXN0b21lcklEID0gY3VzdG9tZXJJRDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZW1vdmUgdGhlIEN1c3RvbWVyIElELiBUaGUgY3VzdG9tZXIgZm9yIHRoZSBBdXRob3JpemF0aW9uIFRva2VuIHdpbGwgYmUgdXNlZCBmb3IgcmVxdWVzdHMuXG5cdCAqL1xuXHRjbGVhck92ZXJyaWRlQ3VzdG9tZXIoKSB7XG5cdFx0dGhpcy5jdXN0b21lcklEID0gdW5kZWZpbmVkO1xuXHRcdHRoaXMuaW5pdENvbXBsZXRlID0gZmFsc2U7XG5cdH1cblxuXHQvKipcblx0ICogR2V0IGFuIGluZm8gb2JqZWN0IGZvciB0aGUgYXV0aG9yaXplZCBjdXN0b21lci5cblx0ICovXG5cdGFzeW5jIGdldEluZm8oKTpQcm9taXNlPFR5cGVzLkN1c3RvbWVySW5mbz4ge1xuXHRcdGNvbnN0IHVyaSA9IFwiL21hbmFnZS9pbmZvXCI7XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5DdXN0b21lckluZm8+KHVyaSwgXCJHRVRcIiwgXCJnZXQtaW5mb1wiKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZW5lcmF0ZXMgYSB2YWxpZCBBUEkga2V5LlxuXHQgKi9cblx0YXN5bmMgZ2VuZXJhdGVBcGlLZXkoKTpQcm9taXNlPFR5cGVzLkFwaUtleVJlc3VsdD4ge1xuXHRcdGxldCB1cmkgPSBcIi9tYW5hZ2UvYXBpa2V5XCI7XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5BcGlLZXlSZXN1bHQ+KHVyaSwgXCJQT1NUXCIsIFwiY3JlYXRlLWFwaWtleVwiKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgYSBsaXN0IG9mIG1lc3NhZ2VzLiBMaW1pdHMgdGhlIG51bWJlciBvZiByZWNvcmRzIGJ5IHBhZ2VTaXplIGFuZCBzdGFydGluZyB3aXRoIHRoZSByZWNvcmQgYXQgbmV4dFBhZ2VJRC5cblx0ICovXG5cdGFzeW5jIGdldE1lc3NhZ2VzKHBhZ2VTaXplOm51bWJlciwgbmV4dFBhZ2VJRD86c3RyaW5nKTpQcm9taXNlPFR5cGVzLk1lc3NhZ2VMaXN0PiB7XG5cdFx0bGV0IHVyaSA9IFwiL21hbmFnZS9jdXN0b21lci97e2N1c3RvbWVySUR9fS9tZXNzYWdlc1wiO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuTWVzc2FnZUxpc3Q+KHVyaSwgXCJHRVRcIiwgXCJsaXN0LW1lc3NhZ2VcIiwgdW5kZWZpbmVkLCB7XG5cdFx0XHRwYWdlc2l6ZTogcGFnZVNpemUsXG5cdFx0XHRuZXh0cGFnZTogbmV4dFBhZ2VJRCxcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgYSBtZXNzYWdlIHJlY29yZC5cblx0ICovXG5cdGFzeW5jIGdldE1lc3NhZ2UobWVzc2FnZUlEOnN0cmluZyk6UHJvbWlzZTxUeXBlcy5NZXNzYWdlPiB7XG5cdFx0Y29uc3QgdXJpID0gYC9tYW5hZ2UvY3VzdG9tZXIve3tjdXN0b21lcklEfX0vbWVzc2FnZS8ke2VuY29kZVVSSUNvbXBvbmVudChtZXNzYWdlSUQpfWA7XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5NZXNzYWdlPih1cmksIFwiR0VUXCIsIFwiZ2V0LW1lc3NhZ2VcIik7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlIGFuIGVtYWlsIG1lc3NhZ2UuXG5cdCAqL1xuXHRhc3luYyBjcmVhdGVFbWFpbE1lc3NhZ2UoZW1haWxNZXNzYWdlOlR5cGVzLkNyZWF0ZUVtYWlsTWVzc2FnZSwgdGVzdDpib29sZWFuKTpQcm9taXNlPFR5cGVzLkNyZWF0ZU1lc3NhZ2VSZXN1bHQ+IHtcblx0XHRjb25zdCB1cmkgPSBcIi9tYW5hZ2UvY3VzdG9tZXIve3tjdXN0b21lcklEfX0vbWVzc2FnZVwiO1xuXHRcdGNvbnN0IGNvbnRlbnRUeXBlID0gdGVzdCA/IFwiY3JlYXRlLXRlc3QtZW1haWwtbWVzc2FnZVwiIDogXCJjcmVhdGUtZW1haWwtbWVzc2FnZVwiO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuQ3JlYXRlTWVzc2FnZVJlc3VsdD4odXJpLCBcIlBPU1RcIiwgY29udGVudFR5cGUsIGVtYWlsTWVzc2FnZSk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlIGFuIFNNUyBtZXNzYWdlLlxuXHQgKi9cblx0YXN5bmMgY3JlYXRlU21zTWVzc2FnZShzbXNNZXNzYWdlOlR5cGVzLkNyZWF0ZVNtc01lc3NhZ2UsIHRlc3Q6Ym9vbGVhbik6UHJvbWlzZTxUeXBlcy5DcmVhdGVNZXNzYWdlUmVzdWx0PiB7XG5cdFx0Y29uc3QgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L21lc3NhZ2VcIjtcblx0XHRjb25zdCBjb250ZW50VHlwZSA9IHRlc3QgPyBcImNyZWF0ZS10ZXN0LXNtcy1tZXNzYWdlXCIgOiBcImNyZWF0ZS1zbXMtbWVzc2FnZVwiO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuQ3JlYXRlTWVzc2FnZVJlc3VsdD4odXJpLCBcIlBPU1RcIiwgY29udGVudFR5cGUsIHNtc01lc3NhZ2UpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhIGxpc3Qgb2YgY3VzdG9tZXJzLiBPbmx5IGFuIGFkbWluIGFwcCBrZXkgY2FuIG1ha2UgdGhpcyByZXF1ZXN0LlxuXHQgKiBMaW1pdHMgdGhlIG51bWJlciBvZiByZWNvcmRzIGJ5IHBhZ2VTaXplIGFuZCBzdGFydGluZyB3aXRoIHRoZSByZWNvcmQgYXQgbmV4dFBhZ2VJRC5cblx0ICovXG5cdGFzeW5jIGdldEN1c3RvbWVycyhwYWdlU2l6ZTpudW1iZXIsIG5leHRQYWdlSUQ/OnN0cmluZyk6UHJvbWlzZTxUeXBlcy5DdXN0b21lckxpc3Q+IHtcblx0XHRsZXQgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyc1wiO1x0Ly8gVGhpcyBVUkkgaXMgZGlmZmVyZW50LiBXZSBkb24ndCBlbWJlZCB0aGUgY2xpZW50IGN1c3RvbWVyIGlkIGJlY2F1c2UgdGhlIGdldCBjdXN0b21lcnMgZW5kcG9pbnQgZG9lcyBub3QgdXNlIGl0LlxuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuQ3VzdG9tZXJMaXN0Pih1cmksIFwiR0VUXCIsIFwibGlzdC1jdXN0b21lclwiLCB1bmRlZmluZWQsIHtcblx0XHRcdHBhZ2VzaXplOiBwYWdlU2l6ZSxcblx0XHRcdG5leHRwYWdlOiBuZXh0UGFnZUlELFxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhIGN1c3RvbWVyIHJlY29yZC4gT25seSBhbiBhZG1pbiBhcHAga2V5IGNhbiBnZXQgY3VzdG9tZXIgcmVjb3JkcyBvdGhlciB0aGFuIGl0cyBvd24uXG5cdCAqL1xuXHRhc3luYyBnZXRDdXN0b21lcihjdXN0b21lcklEPzpzdHJpbmd8dW5kZWZpbmVkKTpQcm9taXNlPFR5cGVzLkN1c3RvbWVyPiB7XG5cdFx0bGV0IHVyaSA9IFwiL21hbmFnZS9jdXN0b21lclwiO1x0Ly8gVGhpcyBVUkkgaXMgZGlmZmVyZW50LiBXZSBkb24ndCBlbWJlZCB0aGUgY2xpZW50IGN1c3RvbWVyIGlkIGJlY2F1c2UgdGhlIGdldCBjdXN0b21lciBlbmRwb2ludCBkb2VzIG5vdCB1c2UgaXQuXG5cblx0XHRpZiAoY3VzdG9tZXJJRCAhPSB1bmRlZmluZWQpIHtcblx0XHRcdHVyaSArPSBcIi9cIiArIGVuY29kZVVSSUNvbXBvbmVudChjdXN0b21lcklEKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5DdXN0b21lcj4odXJpLCBcIkdFVFwiLCBcImdldC1jdXN0b21lclwiKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IGN1c3RvbWVyLiBPbmx5IGFuIGFkbWluIGFwcCBrZXkgY2FuIGNyZWF0ZSBjdXN0b21lcnMuXG5cdCAqL1xuXHRhc3luYyBjcmVhdGVDdXN0b21lcihjdXN0b21lcjpUeXBlcy5DcmVhdGVDdXN0b21lckRhdGEpOlByb21pc2U8VHlwZXMuQ3VzdG9tZXI+IHtcblx0XHRsZXQgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyXCI7XHQvLyBUaGlzIFVSSSBpcyBkaWZmZXJlbnQuIFdlIGRvbid0IGVtYmVkIHRoZSBjbGllbnQgY3VzdG9tZXIgaWQgYmVjYXVzZSB0aGUgY3JlYXRlIGN1c3RvbWVyIGVuZHBvaW50IGRvZXMgbm90IHVzZSBpdC5cblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLkN1c3RvbWVyPih1cmksIFwiUE9TVFwiLCBcImNyZWF0ZS1jdXN0b21lclwiLCBjdXN0b21lcik7XG5cdH1cblxuXHQvKipcblx0ICogVXBkYXRlIGFuIGV4aXN0aW5nIGN1c3RvbWVyLlxuXHQgKi9cblx0YXN5bmMgdXBkYXRlQ3VzdG9tZXIoY3VzdG9tZXJJRDpzdHJpbmcsIGN1c3RvbWVyOlR5cGVzLlVwZGF0ZUN1c3RvbWVyRGF0YSk6UHJvbWlzZTxUeXBlcy5DdXN0b21lcj4ge1xuXHRcdGxldCB1cmkgPSBgL21hbmFnZS9jdXN0b21lci8ke2VuY29kZVVSSUNvbXBvbmVudChjdXN0b21lcklEKX1gO1x0Ly8gVGhpcyBVUkkgaXMgZGlmZmVyZW50LiBXZSBkb24ndCBlbWJlZCB0aGUgY2xpZW50IGN1c3RvbWVyIGlkIGJlY2F1c2UgdGhlIHVwZGF0ZSBjdXN0b21lciBlbmRwb2ludCBkb2VzIHVzZSBpdC5cblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLkN1c3RvbWVyPih1cmksIFwiUEFUQ0hcIiwgXCJ1cGRhdGUtY3VzdG9tZXJcIiwgY3VzdG9tZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlbGV0ZSBhbiBleGlzdGluZyBjdXN0b21lci5cblx0ICovXG5cdGFzeW5jIGRlbGV0ZUN1c3RvbWVyKGN1c3RvbWVySUQ6c3RyaW5nKTpQcm9taXNlPHZvaWQ+IHtcblx0XHRsZXQgdXJpID0gYC9tYW5hZ2UvY3VzdG9tZXIvJHtlbmNvZGVVUklDb21wb25lbnQoY3VzdG9tZXJJRCl9YDtcdC8vIFRoaXMgVVJJIGlzIGRpZmZlcmVudC4gV2UgZG9uJ3QgZW1iZWQgdGhlIGNsaWVudCBjdXN0b21lciBpZCBiZWNhdXNlIHRoZSB1cGRhdGUgY3VzdG9tZXIgZW5kcG9pbnQgZG9lcyB1c2UgaXQuXG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDx2b2lkPih1cmksIFwiREVMRVRFXCIsIFwiZGVsZXRlLWN1c3RvbWVyXCIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhIGxpc3Qgb2YgdGVtcGxhdGVzLlxuXHQgKiBMaW1pdHMgdGhlIG51bWJlciBvZiByZWNvcmRzIGJ5IHBhZ2VTaXplIGFuZCBzdGFydGluZyB3aXRoIHRoZSByZWNvcmQgYXQgbmV4dFBhZ2VJRC5cblx0ICovXG5cdGFzeW5jIGdldFRlbXBsYXRlcyhwYWdlU2l6ZTpudW1iZXIsIG5leHRQYWdlSUQ/OnN0cmluZyk6UHJvbWlzZTxUeXBlcy5UZW1wbGF0ZUxpc3Q+IHtcblx0XHRjb25zdCB1cmkgPSBcIi9tYW5hZ2UvY3VzdG9tZXIve3tjdXN0b21lcklEfX0vdGVtcGxhdGVzXCI7XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5UZW1wbGF0ZUxpc3Q+KHVyaSwgXCJHRVRcIiwgXCJsaXN0LXRlbXBsYXRlXCIsIHVuZGVmaW5lZCwge1xuXHRcdFx0cGFnZXNpemU6IHBhZ2VTaXplLFxuXHRcdFx0bmV4dHBhZ2U6IG5leHRQYWdlSUQsXG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogR2V0IGEgdGVtcGxhdGUgcmVjb3JkLlxuXHQgKi9cblx0YXN5bmMgZ2V0VGVtcGxhdGUoc2x1ZzpzdHJpbmcsIGxvY2FsZTpzdHJpbmd8dW5kZWZpbmVkKTpQcm9taXNlPFR5cGVzLlRlbXBsYXRlPiB7XG5cdFx0bGV0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L3RlbXBsYXRlLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHNsdWcpfWA7XG5cdFx0aWYgKGxvY2FsZSkge1xuXHRcdFx0dXJpICs9IFwiL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGxvY2FsZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuVGVtcGxhdGU+KHVyaSwgXCJHRVRcIiwgXCJnZXQtdGVtcGxhdGVcIik7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB0ZW1wbGF0ZS5cblx0ICovXG5cdGFzeW5jIGNyZWF0ZVRlbXBsYXRlKHRlbXBsYXRlOlR5cGVzLkNyZWF0ZVRlbXBsYXRlRGF0YSk6UHJvbWlzZTxUeXBlcy5UZW1wbGF0ZT4ge1xuXHRcdGNvbnN0IHVyaSA9IFwiL21hbmFnZS9jdXN0b21lci97e2N1c3RvbWVySUR9fS90ZW1wbGF0ZVwiO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuVGVtcGxhdGU+KHVyaSwgXCJQT1NUXCIsIFwiY3JlYXRlLXRlbXBsYXRlXCIsIHRlbXBsYXRlKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBVcGRhdGUgYW4gZXhpc3RpbmcgdGVtcGxhdGUuXG5cdCAqL1xuXHRhc3luYyB1cGRhdGVUZW1wbGF0ZShzbHVnOnN0cmluZywgbG9jYWxlOnN0cmluZ3x1bmRlZmluZWQsIHRlbXBsYXRlOlR5cGVzLlVwZGF0ZVRlbXBsYXRlRGF0YSk6UHJvbWlzZTxUeXBlcy5UZW1wbGF0ZT4ge1xuXHRcdGxldCB1cmkgPSBgL21hbmFnZS9jdXN0b21lci97e2N1c3RvbWVySUR9fS90ZW1wbGF0ZS8ke2VuY29kZVVSSUNvbXBvbmVudChzbHVnKX1gO1xuXHRcdGlmIChsb2NhbGUpIHtcblx0XHRcdHVyaSArPSBcIi9cIiArIGVuY29kZVVSSUNvbXBvbmVudChsb2NhbGUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLlRlbXBsYXRlPih1cmksIFwiUEFUQ0hcIiwgXCJ1cGRhdGUtdGVtcGxhdGVcIiwgdGVtcGxhdGUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlbGV0ZSBhbiBleGlzdGluZyB0ZW1wbGF0ZS5cblx0ICovXG5cdGFzeW5jIGRlbGV0ZVRlbXBsYXRlKHNsdWc6c3RyaW5nLCBsb2NhbGU6c3RyaW5nfHVuZGVmaW5lZCk6UHJvbWlzZTx2b2lkPiB7XG5cdFx0bGV0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L3RlbXBsYXRlLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHNsdWcpfWA7XG5cdFx0aWYgKGxvY2FsZSkge1xuXHRcdFx0dXJpICs9IFwiL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGxvY2FsZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8dm9pZD4odXJpLCBcIkRFTEVURVwiLCBcImRlbGV0ZS10ZW1wbGF0ZVwiKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgYSBsaXN0IG9mIHNlbmRlcnMuXG5cdCAqIExpbWl0cyB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYnkgcGFnZVNpemUgYW5kIHN0YXJ0aW5nIHdpdGggdGhlIHJlY29yZCBhdCBuZXh0UGFnZUlELlxuXHQgKi9cblx0YXN5bmMgZ2V0U2VuZGVycyhwYWdlU2l6ZTpudW1iZXIsIG5leHRQYWdlSUQ/OnN0cmluZyk6UHJvbWlzZTxUeXBlcy5TZW5kZXJMaXN0PiB7XG5cdFx0Y29uc3QgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L3NlbmRlcnNcIjtcblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0KHVyaSwgXCJHRVRcIiwgXCJsaXN0LXNlbmRlclwiLCB1bmRlZmluZWQsIHtcblx0XHRcdHBhZ2VzaXplOiBwYWdlU2l6ZSxcblx0XHRcdG5leHRwYWdlOiBuZXh0UGFnZUlELFxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhIHNlbmRlciByZWNvcmQuXG5cdCAqL1xuXHRhc3luYyBnZXRTZW5kZXIoc2VuZGVySUQ6c3RyaW5nKTpQcm9taXNlPFR5cGVzLlNlbmRlcj4ge1xuXHRcdGNvbnN0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L3NlbmRlci8ke2VuY29kZVVSSUNvbXBvbmVudChzZW5kZXJJRCl9YDtcblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLlNlbmRlcj4odXJpLCBcIkdFVFwiLCBcImdldC1zZW5kZXJcIik7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBzZW5kZXIuXG5cdCAqL1xuXHRhc3luYyBjcmVhdGVTZW5kZXIoc2VuZGVyOlR5cGVzLkNyZWF0ZVNlbmRlckRhdGEpOlByb21pc2U8VHlwZXMuU2VuZGVyPiB7XG5cdFx0Y29uc3QgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L3NlbmRlclwiO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuU2VuZGVyPih1cmksIFwiUE9TVFwiLCBcImNyZWF0ZS1zZW5kZXJcIiwgc2VuZGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBVcGRhdGUgYW4gZXhpc3Rpbmcgc2VuZGVyLlxuXHQgKi9cblx0YXN5bmMgdXBkYXRlU2VuZGVyKHNlbmRlcklEOnN0cmluZywgc2VuZGVyOlR5cGVzLlVwZGF0ZVNlbmRlckRhdGEpOlByb21pc2U8VHlwZXMuU2VuZGVyPiB7XG5cdFx0Y29uc3QgdXJpID0gYC9tYW5hZ2UvY3VzdG9tZXIve3tjdXN0b21lcklEfX0vc2VuZGVyLyR7ZW5jb2RlVVJJQ29tcG9uZW50KHNlbmRlcklEKX1gO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuU2VuZGVyPih1cmksIFwiUEFUQ0hcIiwgXCJ1cGRhdGUtc2VuZGVyXCIsIHNlbmRlcik7XG5cdH1cblxuXHQvKipcblx0ICogRGVsZXRlIGFuIGV4aXN0aW5nIHNlbmRlci5cblx0ICovXG5cdGFzeW5jIGRlbGV0ZVNlbmRlcihzZW5kZXJJRDpzdHJpbmcpOlByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L3NlbmRlci8ke2VuY29kZVVSSUNvbXBvbmVudChzZW5kZXJJRCl9YDtcblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PHZvaWQ+KHVyaSwgXCJERUxFVEVcIiwgXCJkZWxldGUtc2VuZGVyXCIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhIGxpc3Qgb2YgYXBwIGtleXMuXG5cdCAqIExpbWl0cyB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYnkgcGFnZVNpemUgYW5kIHN0YXJ0aW5nIHdpdGggdGhlIHJlY29yZCBhdCBuZXh0UGFnZUlELlxuXHQgKi9cblx0YXN5bmMgZ2V0QXBwS2V5cyhwYWdlU2l6ZTpudW1iZXIsIG5leHRQYWdlSUQ/OnN0cmluZyk6UHJvbWlzZTxUeXBlcy5BcHBLZXlMaXN0PiB7XG5cdFx0Y29uc3QgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L2FwcGtleXNcIjtcblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLkFwcEtleUxpc3Q+KHVyaSwgXCJHRVRcIiwgXCJsaXN0LWFwcGtleVwiLCB1bmRlZmluZWQsIHtcblx0XHRcdHBhZ2VzaXplOiBwYWdlU2l6ZSxcblx0XHRcdG5leHRwYWdlOiBuZXh0UGFnZUlELFxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBhbiBhcHAga2V5IHJlY29yZC5cblx0ICovXG5cdGFzeW5jIGdldEFwcEtleShhcHBLZXlJRDpzdHJpbmcpOlByb21pc2U8VHlwZXMuQXBwS2V5PiB7XG5cdFx0Y29uc3QgdXJpID0gYC9tYW5hZ2UvY3VzdG9tZXIve3tjdXN0b21lcklEfX0vYXBwa2V5LyR7ZW5jb2RlVVJJQ29tcG9uZW50KGFwcEtleUlEKX1gO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuQXBwS2V5Pih1cmksIFwiR0VUXCIsIFwiZ2V0LWFwcGtleVwiKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IGFwcCBrZXkuXG5cdCAqL1xuXHRhc3luYyBjcmVhdGVBcHBLZXkoYXBwS2V5OlR5cGVzLkNyZWF0ZUFwcEtleURhdGEpOlByb21pc2U8VHlwZXMuQXBwS2V5PiB7XG5cdFx0Y29uc3QgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L2FwcGtleVwiO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8VHlwZXMuQXBwS2V5Pih1cmksIFwiUE9TVFwiLCBcImNyZWF0ZS1hcHBrZXlcIiwgYXBwS2V5KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBVcGRhdGUgYW4gZXhpc3RpbmcgYXBwIGtleS5cblx0ICovXG5cdGFzeW5jIHVwZGF0ZUFwcEtleShhcHBLZXlJRDpzdHJpbmcsIGFwcEtleTpUeXBlcy5VcGRhdGVBcHBLZXlEYXRhKTpQcm9taXNlPFR5cGVzLkFwcEtleT4ge1xuXHRcdGNvbnN0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L2FwcGtleS8ke2VuY29kZVVSSUNvbXBvbmVudChhcHBLZXlJRCl9YDtcblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLkFwcEtleT4odXJpLCBcIlBBVENIXCIsIFwidXBkYXRlLWFwcGtleVwiLCBhcHBLZXkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlbGV0ZSBhbiBleGlzdGluZyBhcHAga2V5LlxuXHQgKi9cblx0YXN5bmMgZGVsZXRlQXBwS2V5KGFwcEtleUlEOnN0cmluZyk6UHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgdXJpID0gYC9tYW5hZ2UvY3VzdG9tZXIve3tjdXN0b21lcklEfX0vYXBwa2V5LyR7ZW5jb2RlVVJJQ29tcG9uZW50KGFwcEtleUlEKX1gO1xuXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3Q8dm9pZD4odXJpLCBcIkRFTEVURVwiLCBcImRlbGV0ZS1hcHBrZXlcIik7XG5cdH1cblxuXHQvKipcblx0ICogR2V0IGEgbGlzdCBvZiBibG9ja3MuXG5cdCAqIExpbWl0cyB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYnkgcGFnZVNpemUgYW5kIHN0YXJ0aW5nIHdpdGggdGhlIHJlY29yZCBhdCBuZXh0UGFnZUlELlxuXHQgKi9cblx0YXN5bmMgZ2V0QmxvY2tzKHBhZ2VTaXplOm51bWJlciwgbmV4dFBhZ2VJRD86U3RyaW5nKTpQcm9taXNlPFR5cGVzLkJsb2NrTGlzdD4ge1xuXHRcdGNvbnN0IHVyaSA9IFwiL21hbmFnZS9jdXN0b21lci97e2N1c3RvbWVySUR9fS9ibG9ja3NcIjtcblxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFR5cGVzLkJsb2NrTGlzdD4odXJpLCBcIkdFVFwiLCBcImxpc3QtYmxvY2tcIiwgdW5kZWZpbmVkLCB7XG5cdFx0XHRwYWdlc2l6ZTogcGFnZVNpemUsXG5cdFx0XHRuZXh0cGFnZTogbmV4dFBhZ2VJRCxcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgYSBibG9jayByZWNvcmQuXG5cdCAqL1xuXHRhc3luYyBnZXRCbG9jayhibG9ja0lEOnN0cmluZyk6UHJvbWlzZTxUeXBlcy5CbG9jaz4ge1xuXHRcdGNvbnN0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L2Jsb2NrLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGJsb2NrSUQpfWA7XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5CbG9jaz4odXJpLCBcIkdFVFwiLCBcImdldC1ibG9ja1wiKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IGJsb2NrLlxuXHQgKi9cblx0YXN5bmMgY3JlYXRlQmxvY2soYmxvY2s6VHlwZXMuQ3JlYXRlQmxvY2tEYXRhKTpQcm9taXNlPFR5cGVzLkJsb2NrPiB7XG5cdFx0Y29uc3QgdXJpID0gXCIvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L2Jsb2NrXCI7XG5cblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUeXBlcy5CbG9jaz4odXJpLCBcIlBPU1RcIiwgXCJjcmVhdGUtYmxvY2tcIiwgYmxvY2spO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlbGV0ZSBhIGJsb2NrLlxuXHQgKi9cblx0YXN5bmMgZGVsZXRlQmxvY2soYmxvY2tJRDpzdHJpbmcpOlByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHVyaSA9IGAvbWFuYWdlL2N1c3RvbWVyL3t7Y3VzdG9tZXJJRH19L2Jsb2NrLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGJsb2NrSUQpfWA7XG5cblx0XHRhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PHZvaWQ+KHVyaSwgXCJERUxFVEVcIiwgXCJkZWxldGUtYmxvY2tcIik7XG5cdH1cblxuXHQvLyBJZiB0aGVyZSBpcyBhIG5ldHdvcmsgcmVzcG9uc2Ugd2l0aCBKU09OIHRoZW4gYSB0dXBsZSBpcyByZXR1cm5lZCAoYm9vbGVhbiBzdWNjZXNzLCBvYmplY3QganNvbkNvbnRlbnQpLiBJZiBhbnkgZXhjZXB0aW9ucyBhcmUgdGhyb3duIHRoZXkgYXJlIG5vdCBoYW5kbGVkIGJ5IHRoaXMgbWV0aG9kLlxuXHRwcml2YXRlIGFzeW5jIGV4ZWN1dGVSZXF1ZXN0PFQ+KHVyaTpzdHJpbmcsIG1ldGhvZDpzdHJpbmcsIGNvbnRlbnRUeXBlUmVzb3VyY2U6c3RyaW5nLCByZXF1ZXN0Qm9keT86YW55LCBxdWVyeVBhcmFtZXRlcnM/OmFueSk6UHJvbWlzZTxUPiB7XG5cdFx0YXdhaXQgdGhpcy5pbml0Q2xpZW50KCk7XG5cdFx0dXJpID0gdXJpLnJlcGxhY2UoL3t7Y3VzdG9tZXJJRH19LywgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY3VzdG9tZXJJRCEpKTtcblxuXHRcdGxldCBxcCA9IFwiXCI7XG5cdFx0aWYgKHF1ZXJ5UGFyYW1ldGVycykge1xuXHRcdFx0Zm9yIChjb25zdCBbaywgdl0gb2YgT2JqZWN0LmVudHJpZXMocXVlcnlQYXJhbWV0ZXJzKSkge1xuXHRcdFx0XHRpZiAodiA9PT0gdW5kZWZpbmVkIHx8IHYgPT09IG51bGwpIHtcblx0XHRcdFx0XHRkZWxldGUgcXVlcnlQYXJhbWV0ZXJzW2tdO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHFwID0gXCI/XCIgKyBuZXcgVVJMU2VhcmNoUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyk7XG5cdFx0fVxuXG5cdFx0bGV0IHJlcXVlc3REYXRhOmFueSA9IHVuZGVmaW5lZDtcblx0XHRpZiAocmVxdWVzdEJvZHkpIHtcblx0XHRcdHJlcXVlc3REYXRhID0gKHR5cGVvZiByZXF1ZXN0Qm9keSA9PT0gXCJzdHJpbmdcIikgPyByZXF1ZXN0Qm9keSA6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KTtcblx0XHR9XG5cblx0XHRsZXQgcmVzcG9uc2VCb2R5VGV4dDpzdHJpbmd8dW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuXHRcdGxldCByZXNwb25zZUJvZHk6YW55ID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IHJlc3BvbnNlOlJlc3BvbnNlfHVuZGVmaW5lZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRyZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMuYmFzZVVybCArIHVyaSArIHFwLCB7XG5cdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdFwiQ29udGVudC1UeXBlXCI6IGBhcHBsaWNhdGlvbi92bmQubm90aWZpY2F0aW9uLiR7Y29udGVudFR5cGVSZXNvdXJjZX0udjEranNvbmAsXG5cdFx0XHRcdFx0XCJBdXRob3JpemF0aW9uXCI6IHRoaXMuYXV0aG9yaXphdGlvblRva2VuLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRib2R5OiByZXF1ZXN0RGF0YSxcblx0XHRcdH0pO1xuXHRcdFx0cmVzcG9uc2VCb2R5VGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcblx0XHR9IGNhdGNoIChleDphbnkpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcnMuRmV0Y2hFcnJvcigoZXggYXMgRXJyb3IpLm1lc3NhZ2UsIHsgY2F1c2U6IGV4IH0pO1xuXHRcdH1cblxuXHRcdGlmICghcmVzcG9uc2UpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcnMuUmVzcG9uc2VFcnJvcihcIlNlcnZlciBkaWQgbm90IHJlc3BvbmRcIik7XG5cdFx0fVxuXG5cdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzKSB7XHQvLyBBV1MgSFRUUCBBUEkgR2F0ZXdheSByZXR1cm5zIDQwMyBmcm9tIHRoZSBhdXRob3JpemVyIChpbnN0ZWFkIG9mIDQwMSkgaWYgdGhlIGNyZWRlbnRpYWxzIGFyZSBpbnZhbGlkXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3JzLkF1dGhvcml6YXRpb25FcnJvcihcIkF1dGhvcml6YXRpb24gRmFpbGVkXCIpO1xuXHRcdH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcnMuUmVzcG9uc2VFcnJvcihcIlJlc291cmNlIG5vdCBmb3VuZFwiKTtcblx0XHR9XG5cblxuXHRcdHRyeSB7XG5cdFx0XHRyZXNwb25zZUJvZHkgPSByZXNwb25zZUJvZHlUZXh0ICYmIEpTT04ucGFyc2UocmVzcG9uc2VCb2R5VGV4dCk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcnMuUmVzcG9uc2VFcnJvcihcIkludmFsaWQgcmVzcG9uc2UgY29udGVudFwiLCB7IGNhdXNlOiByZXNwb25zZUJvZHlUZXh0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyAhPSAyMDApIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcnMuUmVzcG9uc2VFcnJvcihyZXNwb25zZUJvZHkuRXJyb3IgfHwgcmVzcG9uc2VCb2R5VGV4dCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJlc3BvbnNlQm9keSBhcyBUO1xuXHR9XG5cblx0Ly8gVGhlcmUgbXVzdCBiZSBhIGNsaWVudCBpZCBzcGVjaWZpZWQuIElmIHdlIGRvbid0IGhhdmUgb25lIHRoZW4gcmV0cmlldmUgdGhlIHZhbHVlIGZvciB0aGUgYXV0aGVudGljYXRlZCBjdXN0b21lci5cblx0Ly8gVGhpcyBpcyBjYWxsZWQgYmVmb3JlIGVhY2ggcmVxdWVzdCB0byB2ZXJpZnkgYSBjdXN0b21lciBJRCBpcyBwcmVzZW50XG5cdHByaXZhdGUgYXN5bmMgaW5pdENsaWVudCgpIHtcblx0XHRpZiAodGhpcy5pbml0Q29tcGxldGUpIHJldHVybjtcblxuXHRcdHRoaXMuaW5pdENvbXBsZXRlID0gdHJ1ZTtcdC8vIE1hcmsgaW5pdCBhcyBjb21wbGV0ZSBiZWZvcmUgdHJpZ2dlcmluZyB0aGUgY3VzdG9tZXIgSUQgbG9va3VwIG9yIHdlIGdldCBjaXJjdWxhciBjYWxsc1xuXG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGRhdGFJdGVtID0gYXdhaXQgdGhpcy5nZXRJbmZvKCk7XG5cdFx0XHR0aGlzLmN1c3RvbWVySUQgPSBkYXRhSXRlbS5DdXN0b21lcklEO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHR0aGlzLmluaXRDb21wbGV0ZSA9IGZhbHNlO1xuXG5cdFx0XHRjb25zdCBlcnJvciA9IGV4IGFzIEVycm9yO1xuXG5cdFx0XHRpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcnMuQXV0aG9yaXphdGlvbkVycm9yKSB0aHJvdyBlcnJvcjtcblx0XHRcdGVsc2UgdGhyb3cgbmV3IEVycm9ycy5Jbml0RXJyb3IoYEZhaWxlZCB0byBpbml0IGNsaWVudDogJHtlcnJvci5tZXNzYWdlfWAsIHsgY2F1c2U6IGVycm9yIH0pO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgaXNVcmwodmFsdWU6c3RyaW5nKTpib29sZWFuIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgdXJsID0gbmV3IFVSTCh2YWx1ZSk7XG5cdFx0XHRyZXR1cm4gdXJsLnByb3RvY29sID09PSBcImh0dHA6XCIgfHwgdXJsLnByb3RvY29sID09PSBcImh0dHBzOlwiO1xuXHRcdH0gY2F0Y2ggeyB9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn1cbiJdfQ==